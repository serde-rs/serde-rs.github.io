
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Handwritten generic type bounds Â· Serde</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-codeblock-rust/block.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-checklist/checklist.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
        <link rel="stylesheet" href="styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="deserialize-map.html" />
    
    
    <link rel="prev" href="attr-flatten.html" />
    

    </head>
    <body>
        
<div class="book with-summary font-size-2">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="help.html">
            
                <a href="help.html">
            
                    
                    Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="data-model.html">
            
                <a href="data-model.html">
            
                    
                    Serde data model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="derive.html">
            
                <a href="derive.html">
            
                    
                    Using derive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="attributes.html">
            
                <a href="attributes.html">
            
                    
                    Attributes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="container-attrs.html">
            
                <a href="container-attrs.html">
            
                    
                    Container attributes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="variant-attrs.html">
            
                <a href="variant-attrs.html">
            
                    
                    Variant attributes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="field-attrs.html">
            
                <a href="field-attrs.html">
            
                    
                    Field attributes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="custom-serialization.html">
            
                <a href="custom-serialization.html">
            
                    
                    Custom serialization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="impl-serialize.html">
            
                <a href="impl-serialize.html">
            
                    
                    Implementing Serialize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="impl-deserialize.html">
            
                <a href="impl-deserialize.html">
            
                    
                    Implementing Deserialize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="unit-testing.html">
            
                <a href="unit-testing.html">
            
                    
                    Unit testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="data-format.html">
            
                <a href="data-format.html">
            
                    
                    Writing a data format
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="conventions.html">
            
                <a href="conventions.html">
            
                    
                    Conventions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="error-handling.html">
            
                <a href="error-handling.html">
            
                    
                    Error handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="impl-serializer.html">
            
                <a href="impl-serializer.html">
            
                    
                    Implementing a Serializer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="impl-deserializer.html">
            
                <a href="impl-deserializer.html">
            
                    
                    Implementing a Deserializer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="lifetimes.html">
            
                <a href="lifetimes.html">
            
                    
                    Deserializer lifetimes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="examples.html">
            
                <a href="examples.html">
            
                    
                    Examples
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="json.html">
            
                <a href="json.html">
            
                    
                    Structs and enums in JSON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="enum-representations.html">
            
                <a href="enum-representations.html">
            
                    
                    Enum representations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="attr-default.html">
            
                <a href="attr-default.html">
            
                    
                    Default value for a field
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="attr-flatten.html">
            
                <a href="attr-flatten.html">
            
                    
                    Struct flattening
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.5" data-path="attr-bound.html">
            
                <a href="attr-bound.html">
            
                    
                    Handwritten generic type bounds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="deserialize-map.html">
            
                <a href="deserialize-map.html">
            
                    
                    Deserialize for custom map type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="stream-array.html">
            
                <a href="stream-array.html">
            
                    
                    Array of values without buffering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="enum-number.html">
            
                <a href="enum-number.html">
            
                    
                    Serialize enum as number
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="attr-rename.html">
            
                <a href="attr-rename.html">
            
                    
                    Serialize fields as camelCase
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="attr-skip-serializing.html">
            
                <a href="attr-skip-serializing.html">
            
                    
                    Skip serializing field
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="remote-derive.html">
            
                <a href="remote-derive.html">
            
                    
                    Derive for remote crate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="deserialize-struct.html">
            
                <a href="deserialize-struct.html">
            
                    
                    Manually deserialize struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="ignored-any.html">
            
                <a href="ignored-any.html">
            
                    
                    Discarding data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="transcode.html">
            
                <a href="transcode.html">
            
                    
                    Transcode into another format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="string-or-struct.html">
            
                <a href="string-or-struct.html">
            
                    
                    Either string or struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="convert-error.html">
            
                <a href="convert-error.html">
            
                    
                    Convert error types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17" data-path="custom-date-format.html">
            
                <a href="custom-date-format.html">
            
                    
                    Custom date format
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="no-std.html">
            
                <a href="no-std.html">
            
                    
                    No-std support
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="feature-flags.html">
            
                <a href="feature-flags.html">
            
                    
                    Feature flags
            
                </a>
            

            
        </li>
    

    
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Handwritten generic type bounds</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="handwritten-generic-type-bounds"><a name="handwritten-generic-type-bounds" class="plugin-anchor" href="#handwritten-generic-type-bounds"><i class="fa fa-link" aria-hidden="true"></i></a>Handwritten generic type bounds</h1>
<p>When deriving <code>Serialize</code> and <code>Deserialize</code> implementations for structs with
generic type parameters, most of the time Serde is able to infer the correct
trait bounds without help from the programmer. It uses several heuristics to
guess the right bound, but most importantly it puts a bound of <code>T: Serialize</code> on
every type parameter <code>T</code> that is part of a serialized field and a bound of <code>T:
Deserialize</code> on every type parameter <code>T</code> that is part of a deserialized field.
As with most heuristics, this is not always right and Serde provides an escape
hatch to replace the automatically generated bound by one written by the
programmer.</p>
<pre><a class="playground-link" target="_blank" href="https://play.rust-lang.org/?edition=2018&amp;gist=d2a50878ab69a5786f5a3a11a9de71ea"></a><code class="lang-rust"><span class="hljs-keyword">use</span> serde::{de, Deserialize, Deserializer};

<span class="hljs-keyword">use</span> std::fmt::Display;
<span class="hljs-keyword">use</span> std::str::FromStr;

<span class="hljs-meta">#[derive(Deserialize, Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Outer</span></span>&lt;<span class="hljs-symbol">&apos;a</span>, S, T: <span class="hljs-symbol">&apos;a</span> + ?<span class="hljs-built_in">Sized</span>&gt; {
    <span class="hljs-comment">// When deriving the Deserialize impl, Serde would want to generate a bound</span>
    <span class="hljs-comment">// `S: Deserialize` on the type of this field. But we are going to use the</span>
    <span class="hljs-comment">// type&apos;s `FromStr` impl instead of its `Deserialize` impl by going through</span>
    <span class="hljs-comment">// `deserialize_from_str`, so we override the automatically generated bound</span>
    <span class="hljs-comment">// by the one required for `deserialize_from_str`.</span>
    <span class="hljs-meta">#[serde(deserialize_with = <span class="hljs-meta-string">&quot;deserialize_from_str&quot;</span>)]</span>
    <span class="hljs-meta">#[serde(bound(deserialize = <span class="hljs-meta-string">&quot;S: FromStr, S::Err: Display&quot;</span>))]</span>
    s: S,

    <span class="hljs-comment">// Here Serde would want to generate a bound `T: Deserialize`. That is a</span>
    <span class="hljs-comment">// stricter condition than is necessary. In fact, the `main` function below</span>
    <span class="hljs-comment">// uses T=str which does not implement Deserialize. We override the</span>
    <span class="hljs-comment">// automatically generated bound by a looser one.</span>
    <span class="hljs-meta">#[serde(bound(deserialize = <span class="hljs-meta-string">&quot;Ptr&lt;&apos;a, T&gt;: Deserialize&lt;&apos;de&gt;&quot;</span>))]</span>
    ptr: Ptr&lt;<span class="hljs-symbol">&apos;a</span>, T&gt;,
}

<span class="hljs-comment">/// Deserialize a type `S` by deserializing a string, then using the `FromStr`</span>
<span class="hljs-comment">/// impl of `S` to create the result. The generic type `S` is not required to</span>
<span class="hljs-comment">/// implement `Deserialize`.</span>
<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">deserialize_from_str</span></span>&lt;<span class="hljs-symbol">&apos;de</span>, S, D&gt;(deserializer: D) -&gt; <span class="hljs-built_in">Result</span>&lt;S, D::Error&gt;
<span class="hljs-keyword">where</span>
    S: FromStr,
    S::<span class="hljs-literal">Err</span>: Display,
    D: Deserializer&lt;<span class="hljs-symbol">&apos;de</span>&gt;,
{
    <span class="hljs-keyword">let</span> s: <span class="hljs-built_in">String</span> = Deserialize::deserialize(deserializer)?;
    S::from_str(&amp;s).map_err(de::Error::custom)
}

<span class="hljs-comment">/// A pointer to `T` which may or may not own the data. When deserializing we</span>
<span class="hljs-comment">/// always want to produce owned data.</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Ptr</span></span>&lt;<span class="hljs-symbol">&apos;a</span>, T: <span class="hljs-symbol">&apos;a</span> + ?<span class="hljs-built_in">Sized</span>&gt; {
    Ref(&amp;<span class="hljs-symbol">&apos;a</span> T),
    Owned(<span class="hljs-built_in">Box</span>&lt;T&gt;),
}

<span class="hljs-keyword">impl</span>&lt;<span class="hljs-symbol">&apos;de</span>, <span class="hljs-symbol">&apos;a</span>, T: <span class="hljs-symbol">&apos;a</span> + ?<span class="hljs-built_in">Sized</span>&gt; Deserialize&lt;<span class="hljs-symbol">&apos;de</span>&gt; <span class="hljs-keyword">for</span> Ptr&lt;<span class="hljs-symbol">&apos;a</span>, T&gt;
<span class="hljs-keyword">where</span>
    <span class="hljs-built_in">Box</span>&lt;T&gt;: Deserialize&lt;<span class="hljs-symbol">&apos;de</span>&gt;,
{
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">deserialize</span></span>&lt;D&gt;(deserializer: D) -&gt; <span class="hljs-built_in">Result</span>&lt;<span class="hljs-keyword">Self</span>, D::Error&gt;
    <span class="hljs-keyword">where</span>
        D: Deserializer&lt;<span class="hljs-symbol">&apos;de</span>&gt;,
    {
        Deserialize::deserialize(deserializer).map(Ptr::Owned)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-keyword">let</span> j = r#<span class="hljs-string">&quot;
        {
            &quot;</span>s<span class="hljs-string">&quot;: &quot;</span><span class="hljs-number">1234567890</span><span class="hljs-string">&quot;,
            &quot;</span>pt<span class="hljs-string">r&quot;: &quot;</span>owned<span class="hljs-string">&quot;
        }
    &quot;</span>#;

    <span class="hljs-keyword">let</span> result: Outer&lt;<span class="hljs-keyword">u64</span>, <span class="hljs-keyword">str</span>&gt; = serde_json::from_str(j).unwrap();

    <span class="hljs-comment">// result = Outer { s: 1234567890, ptr: Owned(&quot;owned&quot;) }</span>
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;result = {:?}&quot;</span>, result);
}
</code></pre>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="attr-flatten.html" class="navigation navigation-prev " aria-label="Previous page: Struct flattening">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="deserialize-map.html" class="navigation navigation-next " aria-label="Next page: Deserialize for custom map type">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Handwritten generic type bounds","level":"1.9.5","depth":2,"next":{"title":"Deserialize for custom map type","level":"1.9.6","depth":2,"path":"deserialize-map.md","ref":"deserialize-map.md","articles":[]},"previous":{"title":"Struct flattening","level":"1.9.4","depth":2,"path":"attr-flatten.md","ref":"attr-flatten.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-search","-sharing","sane-sidebar","codeblock-omit","codeblock-rust","edit-link","ga4","bulk-redirect","checklist","anchors"],"root":"_src","styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"checklist":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"codeblock-rust":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sane-sidebar":{},"codeblock-omit":{},"bulk-redirect":{"redirectsFile":"redirects.json"},"ga4":{"anonymize_ip":true,"cookie_domain":"serde.rs","tag":"G-T5QD1R7FZW"},"edit-link":{"label":"Edit","base":"https://github.com/serde-rs/serde-rs.github.io/edit/master/_src"},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false},"anchors":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Serde","language":"en","gitbook":"*"},"file":{"path":"attr-bound.md","mtime":"2022-07-28T19:54:28.669Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-08-27T15:06:36.040Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-sane-sidebar/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ga4/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

