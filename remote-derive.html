
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Derive for remote crate Â· Serde</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-codeblock-rust/block.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-checklist/checklist.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="deserialize-struct.html" />
    
    
    <link rel="prev" href="attr-skip-serializing.html" />
    

    </head>
    <body>
        
<div class="book with-summary font-size-2">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="help.html">
            
                <a href="help.html">
            
                    
                    Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="data-model.html">
            
                <a href="data-model.html">
            
                    
                    Serde data model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="derive.html">
            
                <a href="derive.html">
            
                    
                    Using derive
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="attributes.html">
            
                <a href="attributes.html">
            
                    
                    Attributes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="container-attrs.html">
            
                <a href="container-attrs.html">
            
                    
                    Container attributes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="variant-attrs.html">
            
                <a href="variant-attrs.html">
            
                    
                    Variant attributes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="field-attrs.html">
            
                <a href="field-attrs.html">
            
                    
                    Field attributes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="custom-serialization.html">
            
                <a href="custom-serialization.html">
            
                    
                    Custom serialization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="impl-serialize.html">
            
                <a href="impl-serialize.html">
            
                    
                    Implementing Serialize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="impl-deserialize.html">
            
                <a href="impl-deserialize.html">
            
                    
                    Implementing Deserialize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="unit-testing.html">
            
                <a href="unit-testing.html">
            
                    
                    Unit testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="data-format.html">
            
                <a href="data-format.html">
            
                    
                    Writing a data format
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="conventions.html">
            
                <a href="conventions.html">
            
                    
                    Conventions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="error-handling.html">
            
                <a href="error-handling.html">
            
                    
                    Error handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="impl-serializer.html">
            
                <a href="impl-serializer.html">
            
                    
                    Implementing a Serializer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="impl-deserializer.html">
            
                <a href="impl-deserializer.html">
            
                    
                    Implementing a Deserializer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="lifetimes.html">
            
                <a href="lifetimes.html">
            
                    
                    Deserializer lifetimes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="examples.html">
            
                <a href="examples.html">
            
                    
                    Examples
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="json.html">
            
                <a href="json.html">
            
                    
                    Structs and enums in JSON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="enum-representations.html">
            
                <a href="enum-representations.html">
            
                    
                    Enum representations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="borrow.html">
            
                <a href="borrow.html">
            
                    
                    Borrowing data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="attr-default.html">
            
                <a href="attr-default.html">
            
                    
                    Default value for a field
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="attr-bound.html">
            
                <a href="attr-bound.html">
            
                    
                    Handwritten generic type bounds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="deserialize-map.html">
            
                <a href="deserialize-map.html">
            
                    
                    Deserialize for custom map type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="stream-array.html">
            
                <a href="stream-array.html">
            
                    
                    Array of values without buffering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="enum-number.html">
            
                <a href="enum-number.html">
            
                    
                    Serialize enum as number
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="attr-rename.html">
            
                <a href="attr-rename.html">
            
                    
                    Serialize fields as camelCase
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="attr-skip-serializing.html">
            
                <a href="attr-skip-serializing.html">
            
                    
                    Skip serializing field
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.11" data-path="remote-derive.html">
            
                <a href="remote-derive.html">
            
                    
                    Derive for remote crate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="deserialize-struct.html">
            
                <a href="deserialize-struct.html">
            
                    
                    Manually deserialize struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="ignored-any.html">
            
                <a href="ignored-any.html">
            
                    
                    Discarding data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="transcode.html">
            
                <a href="transcode.html">
            
                    
                    Transcode into another format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="string-or-struct.html">
            
                <a href="string-or-struct.html">
            
                    
                    Either string or struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="convert-error.html">
            
                <a href="convert-error.html">
            
                    
                    Convert error types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17" data-path="custom-date-format.html">
            
                <a href="custom-date-format.html">
            
                    
                    Custom date format
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="feature-flags.html">
            
                <a href="feature-flags.html">
            
                    
                    Feature flags
            
                </a>
            

            
        </li>
    

    
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Derive for remote crate</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="deriving-deserialize-for-type-in-a-different-crate">Deriving De/Serialize for type in a different crate</h1>
<p>Rust&apos;s <a href="https://doc.rust-lang.org/book/traits.html#rules-for-implementing-traits" target="_blank">orphan rule</a> requires that either the trait or the type for which you
are implementing the trait must be defined in the same crate as the impl, so it
is not possible to implement <code>Serialize</code> and <code>Deserialize</code> for a type in a
different crate directly.</p>
<pre><code class="lang-diff"><span class="hljs-deletion">- use serde::Serialize;</span>
<span class="hljs-deletion">- use other_crate::Duration;</span>
<span class="hljs-deletion">-</span>
<span class="hljs-deletion">- // Not allowed by orphan rule.</span>
<span class="hljs-deletion">- impl Serialize for Duration {</span>
<span class="hljs-deletion">-     /* ... */</span>
<span class="hljs-deletion">- }</span>
</code></pre>
<p>To work around this, Serde provides a way of deriving <code>Serialize</code> and
<code>Deserialize</code> implementations for types in other people&apos;s crates. The only catch
is that you have to provide a definition of the type for Serde&apos;s derive to
process. At compile time, Serde will check that all the fields in the definition
you provided match the fields in the remote type.</p>
<pre><code class="lang-rust"><span class="hljs-comment">// Pretend that this is somebody else&apos;s crate, not a module.</span>
<span class="hljs-keyword">mod</span> other_crate {
    <span class="hljs-comment">// Neither Serde nor the other crate provides Serialize and Deserialize</span>
    <span class="hljs-comment">// impls for this struct.</span>
    <span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Duration</span></span> {
        <span class="hljs-keyword">pub</span> secs: <span class="hljs-keyword">i64</span>,
        <span class="hljs-keyword">pub</span> nanos: <span class="hljs-keyword">i32</span>,
    }
}

<span class="hljs-comment">////////////////////////////////////////////////////////////////////////////////</span>

<span class="hljs-meta">#[macro_use]</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> serde_derive;

<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> serde;

<span class="hljs-keyword">use</span> other_crate::Duration;

<span class="hljs-comment">// Serde calls this the definition of the remote type. It is just a copy of the</span>
<span class="hljs-comment">// remote type. The `remote` attribute gives the path to the actual type.</span>
<span class="hljs-meta">#[derive(Serialize, Deserialize)]</span>
<span class="hljs-meta">#[serde(remote = <span class="hljs-meta-string">&quot;Duration&quot;</span>)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DurationDef</span></span> {
    secs: <span class="hljs-keyword">i64</span>,
    nanos: <span class="hljs-keyword">i32</span>,
}

<span class="hljs-comment">// Now the remote type can be used almost like it had its own Serialize and</span>
<span class="hljs-comment">// Deserialize impls all along. The `with` attribute gives the path to the</span>
<span class="hljs-comment">// definition for the remote type. Note that the real type of the field is the</span>
<span class="hljs-comment">// remote type, not the definition type.</span>
<span class="hljs-meta">#[derive(Serialize, Deserialize)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Process</span></span> {
    command_line: <span class="hljs-built_in">String</span>,

    <span class="hljs-meta">#[serde(with = <span class="hljs-meta-string">&quot;DurationDef&quot;</span>)]</span>
    wall_time: Duration,
}
</code></pre>
<p>If the remote type is a struct with all public fields or an enum, that&apos;s all
there is to it. If the remote type is a struct with one or more private fields,
getters must be provided for the private fields and a conversion must be
provided to construct the remote type.</p>
<pre><code class="lang-rust"><span class="hljs-comment">// Pretend that this is somebody else&apos;s crate, not a module.</span>
<span class="hljs-keyword">mod</span> other_crate {
    <span class="hljs-comment">// Neither Serde nor the other crate provides Serialize and Deserialize</span>
    <span class="hljs-comment">// impls for this struct. Oh, and the fields are private.</span>
    <span class="hljs-keyword">pub</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Duration</span></span> {
        secs: <span class="hljs-keyword">i64</span>,
        nanos: <span class="hljs-keyword">i32</span>,
    }

    <span class="hljs-keyword">impl</span> Duration {
        <span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">new</span></span>(secs: <span class="hljs-keyword">i64</span>, nanos: <span class="hljs-keyword">i32</span>) -&gt; <span class="hljs-keyword">Self</span> {
            Duration { secs: secs, nanos: nanos }
        }

        <span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">seconds</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-keyword">i64</span> {
            <span class="hljs-keyword">self</span>.secs
        }

        <span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">subsec_nanos</span></span>(&amp;<span class="hljs-keyword">self</span>) -&gt; <span class="hljs-keyword">i32</span> {
            <span class="hljs-keyword">self</span>.nanos
        }
    }
}

<span class="hljs-comment">////////////////////////////////////////////////////////////////////////////////</span>

<span class="hljs-meta">#[macro_use]</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> serde_derive;

<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> serde;

<span class="hljs-keyword">use</span> other_crate::Duration;

<span class="hljs-comment">// Provide getters for every private field of the remote struct. The getter must</span>
<span class="hljs-comment">// return either `T` or `&amp;T` where `T` is the type of the field.</span>
<span class="hljs-meta">#[derive(Serialize, Deserialize)]</span>
<span class="hljs-meta">#[serde(remote = <span class="hljs-meta-string">&quot;Duration&quot;</span>)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">DurationDef</span></span> {
    <span class="hljs-meta">#[serde(getter = <span class="hljs-meta-string">&quot;Duration::seconds&quot;</span>)]</span>
    secs: <span class="hljs-keyword">i64</span>,
    <span class="hljs-meta">#[serde(getter = <span class="hljs-meta-string">&quot;Duration::subsec_nanos&quot;</span>)]</span>
    nanos: <span class="hljs-keyword">i32</span>,
}

<span class="hljs-comment">// Provide a conversion to construct the remote type.</span>
<span class="hljs-keyword">impl</span> <span class="hljs-built_in">From</span>&lt;DurationDef&gt; <span class="hljs-keyword">for</span> Duration {
    <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">from</span></span>(def: DurationDef) -&gt; Duration {
        Duration::new(def.secs, def.nanos)
    }
}

<span class="hljs-meta">#[derive(Serialize, Deserialize)]</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Process</span></span> {
    command_line: <span class="hljs-built_in">String</span>,

    <span class="hljs-meta">#[serde(with = <span class="hljs-meta-string">&quot;DurationDef&quot;</span>)]</span>
    wall_time: Duration,
}
</code></pre>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="attr-skip-serializing.html" class="navigation navigation-prev " aria-label="Previous page: Skip serializing field">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="deserialize-struct.html" class="navigation navigation-next " aria-label="Next page: Manually deserialize struct">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Derive for remote crate","level":"1.9.11","depth":2,"next":{"title":"Manually deserialize struct","level":"1.9.12","depth":2,"path":"deserialize-struct.md","ref":"deserialize-struct.md","articles":[]},"previous":{"title":"Skip serializing field","level":"1.9.10","depth":2,"path":"attr-skip-serializing.md","ref":"attr-skip-serializing.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-search","-sharing","sane-sidebar","codeblock-omit","codeblock-rust","edit-link","ga","bulk-redirect","checklist"],"root":"_src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"checklist":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"codeblock-rust":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sane-sidebar":{},"codeblock-omit":{},"bulk-redirect":{"redirectsFile":"redirects.json"},"ga":{"configuration":"auto","token":"UA-82804814-1"},"edit-link":{"label":"Edit","base":"https://github.com/serde-rs/serde-rs.github.io/edit/master/_src"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Serde","language":"en","gitbook":"*"},"file":{"path":"remote-derive.md","mtime":"2017-04-22T16:57:04.659Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-04-26T14:52:01.853Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-sane-sidebar/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

